//
// Copyright (C) 2014 The Android Open Source Project
// All rights reserved.
//
// Redistribution and use in source and binary forms, with or without
// modification, are permitted provided that the following conditions
// are met:
//  * Redistributions of source code must retain the above copyright
//    notice, this list of conditions and the following disclaimer.
//  * Redistributions in binary form must reproduce the above copyright
//    notice, this list of conditions and the following disclaimer in
//    the documentation and/or other materials provided with the
//    distribution.
//
// THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS
// "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT
// LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS
// FOR A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE
// COPYRIGHT OWNER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT,
// INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING,
// BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS
// OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED
// AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY,
// OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT
// OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF
// SUCH DAMAGE.
//
//
// Copyright (c) 2014 ARM Ltd
// All rights reserved.
//
// Redistribution and use in source and binary forms, with or without
// modification, are permitted provided that the following conditions
// are met:
// 1. Redistributions of source code must retain the above copyright
//    notice, this list of conditions and the following disclaimer.
// 2. Redistributions in binary form must reproduce the above copyright
//    notice, this list of conditions and the following disclaimer in the
//    documentation and/or other materials provided with the distribution.
// 3. The name of the company may not be used to endorse or promote
//    products derived from this software without specific prior written
//    permission.
//
// THIS SOFTWARE IS PROVIDED BY ARM LTD ``AS IS'' AND ANY EXPRESS OR IMPLIED
// WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF
// MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE DISCLAIMED.
// IN NO EVENT SHALL ARM LTD BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,
// SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED
// TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR
// PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF
// LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING
// NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS
// SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.

vixl_cppflags = [
    "-DUSE_SIMULATOR",
    "-Wall",
    "-Wextra",
    "-Werror",
    "-fdiagnostics-show-option",
    "-Wredundant-decls",
    "-Wunreachable-code",
    "-pedantic",
    "-std=c++11",
    // Explicitly enable the write-strings warning. VIXL uses
    // const correctly when handling string constants.
    "-Wwrite-strings",
]

vixl_cppflags_debug = [
    "-DVIXL_DEBUG",
    "-UNDEBUG",
    "-O2",
    "-ggdb3",
]

cc_library {
    host_supported: true,
    clang: true,

    local_include_dirs: ["src/"],
    srcs: [
        "src/vixl/a64/assembler-a64.cc",
        "src/vixl/a64/cpu-a64.cc",
        "src/vixl/a64/debugger-a64.cc",
        "src/vixl/a64/decoder-a64.cc",
        "src/vixl/a64/disasm-a64.cc",
        "src/vixl/a64/instructions-a64.cc",
        "src/vixl/a64/instrument-a64.cc",
        "src/vixl/a64/logic-a64.cc",
        "src/vixl/a64/macro-assembler-a64.cc",
        "src/vixl/a64/simulator-a64.cc",
        "src/vixl/code-buffer.cc",
        "src/vixl/compiler-intrinsics.cc",
        "src/vixl/utils.cc",
    ],
    shared_libs: ["liblog"],
    name: "libvixl",

    cppflags: vixl_cppflags,
    clang_cflags: ["-Wimplicit-fallthrough"],

    arch: {
        arm64: {
            cppflags: ["-UUSE_SIMULATOR"],
        },
    },

    debug: {
        cflags: vixl_cppflags_debug,
    },
    release: {
        cflags: ["-O3"],
    },
}

//######## VIXL HOST TESTS #########
//
// We only support 64bit host builds for now.
// To run all the tests: vixl-test-runner --run_all
//
cc_binary_host {
    clang: true,

    cppflags: vixl_cppflags + vixl_cppflags_debug,
    local_include_dirs: ["src/"],
    srcs: [
        "test/test-runner.cc",
        "test/test-assembler-a64.cc",
        "test/test-disasm-a64.cc",
        "test/test-fuzz-a64.cc",
        "test/test-invalset.cc",
        "test/test-simulator-a64.cc",
        "test/test-utils-a64.cc",
    ],
    whole_static_libs: ["libvixl"],
    // ANDROIDMK TRANSLATION ERROR: unsupported assignment to LOCAL_MODULE_HOST_ARCH
    // LOCAL_MODULE_HOST_ARCH:=x86_64
    static_executable: true,
    name: "vixl-test-runner",
}
